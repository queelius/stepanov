cmake_minimum_required(VERSION 3.14)

# Unit tests subdirectory
add_subdirectory(unit)

# Integration tests subdirectory
add_subdirectory(integration)

# Benchmarks subdirectory
if(STEPANOV_BUILD_BENCHMARKS)
    add_subdirectory(benchmarks)
endif()

# Add a custom target to run all tests with verbose output
add_custom_target(test_verbose
    COMMAND ${CMAKE_CTEST_COMMAND} --verbose --output-on-failure
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "Running all tests with verbose output"
)

# Add a custom target for coverage with tests
if(STEPANOV_ENABLE_COVERAGE)
    add_custom_target(test_coverage
        COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure
        COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target coverage
        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
        COMMENT "Running tests and generating coverage report"
    )
endif()